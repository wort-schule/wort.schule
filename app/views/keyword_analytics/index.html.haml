- set_meta_tags title: t('.page_title')

%h1.text-3xl.font-bold.mb-6= t('.title')

/ Main Stats Grid
= box do
  .mb-6
    %h2.text-xl.font-semibold.mb-4= t('.overview')
    .grid.grid-cols-2.md:grid-cols-4.lg:grid-cols-6.gap-4
      .bg-blue-50.p-4.rounded-lg.text-center
        %p.text-xs.text-gray-600.uppercase.tracking-wide= t('.total_records')
        %p.text-2xl.font-bold.text-blue-600= number_with_delimiter(@total_records)
      .bg-green-50.p-4.rounded-lg.text-center
        %p.text-xs.text-gray-600.uppercase.tracking-wide= t('.overall_success_rate')
        %p.text-2xl.font-bold.text-green-600= "#{@overall_success_rate}%"
      .bg-purple-50.p-4.rounded-lg.text-center
        %p.text-xs.text-gray-600.uppercase.tracking-wide= t('.unique_guesses')
        %p.text-2xl.font-bold.text-purple-600= number_with_delimiter(@total_unique_picks)
      .bg-indigo-50.p-4.rounded-lg.text-center
        %p.text-xs.text-gray-600.uppercase.tracking-wide= t('.words_played')
        %p.text-2xl.font-bold.text-indigo-600= number_with_delimiter(@total_words_played)
      .bg-pink-50.p-4.rounded-lg.text-center
        %p.text-xs.text-gray-600.uppercase.tracking-wide= t('.keywords_used')
        %p.text-2xl.font-bold.text-pink-600= number_with_delimiter(@total_keywords_used)
      .bg-amber-50.p-4.rounded-lg.text-center
        %p.text-xs.text-gray-600.uppercase.tracking-wide= t('.avg_guess_time')
        %p.text-2xl.font-bold.text-amber-600
          - if @avg_time_to_guess > 0
            = "#{(@avg_time_to_guess / 1000.0).round(1)}s"
          - else
            = "-"

/ Recent Activity
= box do
  %h2.text-xl.font-semibold.mb-4= t('.recent_activity')
  .grid.grid-cols-1.md:grid-cols-3.gap-4
    .bg-gradient-to-br.from-blue-500.to-blue-600.p-4.rounded-lg.text-white
      %p.text-sm.opacity-90= t('.last_24h')
      %p.text-3xl.font-bold= number_with_delimiter(@recent_activity[:last_24h])
    .bg-gradient-to-br.from-purple-500.to-purple-600.p-4.rounded-lg.text-white
      %p.text-sm.opacity-90= t('.last_7d')
      %p.text-3xl.font-bold= number_with_delimiter(@recent_activity[:last_7d])
    .bg-gradient-to-br.from-indigo-500.to-indigo-600.p-4.rounded-lg.text-white
      %p.text-sm.opacity-90= t('.last_30d')
      %p.text-3xl.font-bold= number_with_delimiter(@recent_activity[:last_30d])

/ Top and Worst Keywords Side by Side
.grid.grid-cols-1.lg:grid-cols-2.gap-6.my-6
  / Top Performing Keywords
  - if @top_keywords.any?
    = box do
      %h2.text-xl.font-semibold.mb-2.text-green-700
        %span.inline-block.mr-2 â˜…
        = t('.top_keywords_title')
      %p.text-sm.text-gray-600.mb-4= t('.top_keywords_description')

      .space-y-3
        - @top_keywords.each_with_index do |kw, index|
          .flex.items-center.p-3.bg-green-50.rounded-lg.border.border-green-100
            .flex-shrink-0.w-8.h-8.bg-green-500.text-white.rounded-full.flex.items-center.justify-center.font-bold.text-sm
              = index + 1
            .ml-3.flex-grow
              .flex.items-center.justify-between
                = link_to kw[:keyword].name, kw[:keyword], class: 'font-medium text-green-800 hover:text-green-900'
                %span.text-lg.font-bold.text-green-600= "#{kw[:success_rate]}%"
              .flex.items-center.text-xs.text-gray-600.mt-1
                %span= "#{kw[:times_correct]}/#{kw[:times_shown]} #{t('.correct_of_shown')}"
                - if kw[:avg_time_ms]
                  %span.mx-2 â€¢
                  %span= "#{(kw[:avg_time_ms] / 1000.0).round(1)}s #{t('.avg_time')}"
              / Progress bar
              .mt-2.h-2.bg-green-200.rounded-full.overflow-hidden
                .h-full.bg-green-500.rounded-full{ style: "width: #{kw[:success_rate]}%" }

  / Worst Performing Keywords
  - if @worst_keywords.any?
    = box do
      %h2.text-xl.font-semibold.mb-2.text-red-700
        %span.inline-block.mr-2 âš 
        = t('.worst_keywords_title')
      %p.text-sm.text-gray-600.mb-4= t('.worst_keywords_description')

      .space-y-3
        - @worst_keywords.each_with_index do |kw, index|
          .flex.items-center.p-3.bg-red-50.rounded-lg.border.border-red-100
            .flex-shrink-0.w-8.h-8.bg-red-500.text-white.rounded-full.flex.items-center.justify-center.font-bold.text-sm
              = index + 1
            .ml-3.flex-grow
              .flex.items-center.justify-between
                = link_to kw[:keyword].name, kw[:keyword], class: 'font-medium text-red-800 hover:text-red-900'
                %span.text-lg.font-bold.text-red-600= "#{kw[:success_rate]}%"
              .flex.items-center.text-xs.text-gray-600.mt-1
                %span= "#{kw[:times_correct]}/#{kw[:times_shown]} #{t('.correct_of_shown')}"
                - if kw[:avg_time_ms]
                  %span.mx-2 â€¢
                  %span= "#{(kw[:avg_time_ms] / 1000.0).round(1)}s #{t('.avg_time')}"
              / Progress bar
              .mt-2.h-2.bg-red-200.rounded-full.overflow-hidden
                .h-full.bg-red-500.rounded-full{ style: "width: #{kw[:success_rate]}%" }

/ Problematic Words Section
- if @problematic_words.empty?
  = box do
    %p.text-center.text-gray-600= t('.no_data')
- else
  = box do
    %h2.text-xl.font-semibold.mb-2.text-yellow-700
      %span.inline-block.mr-2 âš¡
      = t('.problematic_words_title')
    %p.text-sm.text-gray-600.mb-4= t('.problematic_words_description')

    .overflow-x-auto
      %table.w-full.text-sm
        %thead
          %tr.border-b-2.border-gray-300.bg-gray-50
            %th.px-4.py-3.text-left.font-semibold= t('.word')
            %th.px-4.py-3.text-left.font-semibold= t('.word_type')
            %th.px-4.py-3.text-right.font-semibold= t('.total_attempts')
            %th.px-4.py-3.text-right.font-semibold= t('.correct')
            %th.px-4.py-3.text-right.font-semibold= t('.failures')
            %th.px-4.py-3.text-center.font-semibold= t('.failure_rate')
            %th.px-4.py-3.text-right.font-semibold= t('.actions')

        %tbody
          - @problematic_words.each do |row|
            - next unless row[:word]
            %tr.border-b.border-gray-100.hover:bg-yellow-50.transition-colors
              %td.px-4.py-3
                = link_to row[:word].name, row[:word], class: 'text-blue-600 hover:text-blue-900 font-medium'
              %td.px-4.py-3
                %span.text-xs.bg-blue-100.text-blue-800.px-2.py-1.rounded
                  = row[:word].class.model_name.human
              %td.px-4.py-3.text-right.font-medium= row[:total_attempts]
              %td.px-4.py-3.text-right.text-green-600.font-medium= row[:correct_count]
              %td.px-4.py-3.text-right.text-red-600.font-medium= row[:failures]
              %td.px-4.py-3
                - rate = row[:failure_rate].to_f
                .flex.items-center.justify-center
                  .w-full.max-w-24
                    .flex.items-center.justify-between.mb-1
                      %span{ class: rate >= 50 ? 'text-red-600 font-bold text-sm' : 'text-yellow-600 font-medium text-sm' }
                        = "#{rate}%"
                    .h-2.bg-gray-200.rounded-full.overflow-hidden
                      .h-full.rounded-full{ class: rate >= 50 ? 'bg-red-500' : 'bg-yellow-500', style: "width: #{rate}%" }
              %td.px-4.py-3.text-right
                = link_to t('.details'), keyword_analytic_path(row[:word]), class: 'button button-sm primary'

/ All Keyword-Word Pairs Table
- if @all_keyword_pairs.any?
  = box do
    %h2.text-xl.font-semibold.mb-2.text-blue-700
      %span.inline-block.mr-2 ðŸ“Š
      = t('.all_pairs_title')
    %p.text-sm.text-gray-600.mb-4= t('.all_pairs_description')

    .overflow-x-auto
      %table.w-full.text-sm
        %thead
          %tr.border-b-2.border-gray-300.bg-gray-50
            %th.px-4.py-3.text-left.font-semibold= t('.target_word')
            %th.px-4.py-3.text-left.font-semibold= t('.keyword')
            %th.px-4.py-3.text-right.font-semibold= t('.times_shown')
            %th.px-4.py-3.text-right.font-semibold= t('.times_correct')
            %th.px-4.py-3.text-center.font-semibold= t('.success_rate_header')
            %th.px-4.py-3.text-right.font-semibold= t('.avg_time_header')
            %th.px-4.py-3.text-right.font-semibold= t('.avg_position_header')

        %tbody
          - @all_keyword_pairs.each do |pair|
            - rate = pair[:success_rate]
            - row_class = rate >= 80 ? 'bg-green-50' : (rate >= 50 ? 'bg-yellow-50' : 'bg-red-50')
            %tr.border-b.border-gray-100.hover:opacity-80.transition-opacity{ class: row_class }
              %td.px-4.py-3
                = link_to pair[:word].name, pair[:word], class: 'text-blue-600 hover:text-blue-900 font-medium'
              %td.px-4.py-3
                = link_to pair[:keyword].name, pair[:keyword], class: 'text-blue-600 hover:text-blue-900'
              %td.px-4.py-3.text-right.font-medium= pair[:times_shown]
              %td.px-4.py-3.text-right.text-green-600.font-medium= pair[:times_correct]
              %td.px-4.py-3
                .flex.items-center.justify-center
                  .w-full.max-w-28
                    .flex.items-center.justify-between.mb-1
                      %span{ class: rate >= 80 ? 'text-green-600 font-bold text-sm' : (rate >= 50 ? 'text-yellow-600 font-medium text-sm' : 'text-red-600 font-bold text-sm') }
                        = "#{rate}%"
                    .h-2.bg-gray-200.rounded-full.overflow-hidden
                      - bar_class = rate >= 80 ? 'bg-green-500' : (rate >= 50 ? 'bg-yellow-500' : 'bg-red-500')
                      .h-full.rounded-full{ class: bar_class, style: "width: #{rate}%" }
              %td.px-4.py-3.text-right
                - if pair[:avg_time_ms]
                  = "#{(pair[:avg_time_ms] / 1000.0).round(1)}s"
                - else
                  %span.text-gray-400 -
              %td.px-4.py-3.text-right
                %span.text-gray-600= pair[:avg_position]

/ Legend/Help Section
= box do
  %h2.text-xl.font-semibold.mb-4= t('.understanding_data')
  .grid.grid-cols-1.md:grid-cols-3.gap-4.text-sm
    .p-3.bg-green-50.rounded-lg.border.border-green-200
      %p.font-semibold.text-green-800.mb-1= t('.good_keyword')
      %p.text-gray-600= t('.good_keyword_description')
    .p-3.bg-yellow-50.rounded-lg.border.border-yellow-200
      %p.font-semibold.text-yellow-800.mb-1= t('.average_keyword')
      %p.text-gray-600= t('.average_keyword_description')
    .p-3.bg-red-50.rounded-lg.border.border-red-200
      %p.font-semibold.text-red-800.mb-1= t('.poor_keyword')
      %p.text-gray-600= t('.poor_keyword_description')

/ How it works Section
= box do
  %h2.text-xl.font-semibold.mb-4= t('.how_it_works_title')

  .space-y-4.text-sm.text-gray-700
    .p-4.bg-blue-50.rounded-lg.border.border-blue-200
      %h3.font-semibold.text-blue-800.mb-2= t('.data_collection_title')
      %p.mb-2= t('.data_collection_description')
      %ul.list-disc.list-inside.space-y-1.text-gray-600
        %li= t('.data_collection_item1')
        %li= t('.data_collection_item2')
        %li= t('.data_collection_item3')

    .grid.grid-cols-1.md:grid-cols-2.gap-4
      .p-4.bg-gray-50.rounded-lg.border.border-gray-200
        %h3.font-semibold.text-gray-800.mb-2= t('.metric_success_rate_title')
        %p.mb-2= t('.metric_success_rate_description')
        %code.text-xs.bg-gray-200.px-2.py-1.rounded= t('.metric_success_rate_formula')

      .p-4.bg-gray-50.rounded-lg.border.border-gray-200
        %h3.font-semibold.text-gray-800.mb-2= t('.metric_avg_time_title')
        %p.mb-2= t('.metric_avg_time_description')
        %code.text-xs.bg-gray-200.px-2.py-1.rounded= t('.metric_avg_time_formula')

      .p-4.bg-gray-50.rounded-lg.border.border-gray-200
        %h3.font-semibold.text-gray-800.mb-2= t('.metric_position_title')
        %p= t('.metric_position_description')

      .p-4.bg-gray-50.rounded-lg.border.border-gray-200
        %h3.font-semibold.text-gray-800.mb-2= t('.metric_min_samples_title')
        %p= t('.metric_min_samples_description')

    .p-4.bg-amber-50.rounded-lg.border.border-amber-200
      %h3.font-semibold.text-amber-800.mb-2= t('.interpretation_title')
      %ul.list-disc.list-inside.space-y-1.text-gray-600
        %li= t('.interpretation_item1')
        %li= t('.interpretation_item2')
        %li= t('.interpretation_item3')
        %li= t('.interpretation_item4')
