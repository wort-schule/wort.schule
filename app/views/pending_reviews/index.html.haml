- set_meta_tags title: t('.page_title')

%h1.text-3xl.font-bold.mb-6= t('.title')

- if @no_matches
  = box do
    .mb-6
      %p.text-center.text-red-600
        = t('.no_matches')
      %p.text-center.text-sm.text-gray-600
        = t('.filter_was', filter: @filter)
      .text-center.mt-4
        = link_to t('.back'), pending_reviews_path, class: 'button primary'

- if @change_groups.empty? && !@no_matches
  = box do
    %p.text-center.text-gray-600= t('.no_pending_reviews')
- elsif !@no_matches
  = box do
    %details.filter-section.mb-4{ open: (@filter.present? || @word_type_filter.present? || @keyword_filter.present?) }
      %summary.cursor-pointer.text-blue-600.hover:text-blue-800.font-medium.py-2
        = t('.show_filters')
      .mt-4.p-4.bg-gray-50.rounded-lg
        = form_with url: pending_reviews_path, method: :get, class: 'space-y-4' do |f|
          .grid.grid-cols-1.md:grid-cols-3.gap-4
            .flex.flex-col
              = f.label :filter, t('.filter_table_placeholder'), class: 'text-sm font-medium text-gray-700 mb-1'
              = f.text_field :filter, value: @filter, placeholder: "z.B. Haus*", class: 'px-3 py-2 border border-gray-300 rounded-md text-sm'

            .flex.flex-col
              = f.label :word_type_filter, t('.word_type_filter'), class: 'text-sm font-medium text-gray-700 mb-1'
              = f.select :word_type_filter, options_for_select([[t('.word_type_all'), '']] + [['Noun', 'Noun'], ['Verb', 'Verb'], ['Adjective', 'Adjective'], ['FunctionWord', 'FunctionWord']], @word_type_filter), {}, class: 'px-3 py-2 border border-gray-300 rounded-md text-sm'

            .flex.flex-col
              = f.label :keyword_filter, t('.keyword_filter'), class: 'text-sm font-medium text-gray-700 mb-1'
              = f.text_field :keyword_filter, value: @keyword_filter, placeholder: "z.B. Tier*", class: 'px-3 py-2 border border-gray-300 rounded-md text-sm'

          .text-xs.text-gray-500.italic
            = t('.filter_examples')

          = f.hidden_field :sort_by, value: @sort_by
          = f.hidden_field :sort_direction, value: @sort_direction
          = f.hidden_field :per_page, value: @per_page

          .flex.gap-3.items-center
            = f.submit t('.filter_table_button'), class: 'button button-sm primary'
            - if @filter.present? || @word_type_filter.present? || @keyword_filter.present?
              = link_to t('.clear_filter'), pending_reviews_path(sort_by: @sort_by, sort_direction: @sort_direction, per_page: @per_page), class: 'button button-sm'

    - if @filter.present? || @word_type_filter.present? || @keyword_filter.present?
      .mb-4{"data-controller": "delete-confirmation"}
        %button.button.button-sm.danger{"data-action": "click->delete-confirmation#open", type: "button"}
          = t('.delete_filtered_button', count: @change_groups.total_count)

        %dialog.rounded-lg.shadow-2xl.p-0{"data-delete-confirmation-target": "dialog"}
          .p-6
            .mb-6.text-center
              %svg.mx-auto.h-12.w-12.text-red-600{viewBox: "0 0 24 24", fill: "none", stroke: "currentColor"}
                %path{stroke_linecap: "round", stroke_linejoin: "round", stroke_width: "2", d: "M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"}

            %h2.text-2xl.font-bold.mb-4.text-gray-900.text-center
              = t('.confirm_deletion', count: @change_groups.total_count)

            %p.text-gray-600.mb-2.text-center
              = t('.filtered_by', filter: [@filter, @word_type_filter, @keyword_filter].compact.join(", "))

            %p.text-sm.text-gray-500.mb-8.text-center.font-semibold.text-red-600
              = t('.warning')

            .flex.justify-center.gap-4
              = form_with url: delete_filtered_pending_reviews_path, method: :post do |f|
                = f.hidden_field :filter, value: @filter
                = f.hidden_field :word_type_filter, value: @word_type_filter
                = f.hidden_field :keyword_filter, value: @keyword_filter
                = f.hidden_field :sort_by, value: @sort_by
                = f.hidden_field :sort_direction, value: @sort_direction
                = f.hidden_field :per_page, value: @per_page
                = f.submit t('.confirm_delete'), class: 'button danger px-6 py-3'
              %button.button.primary.px-6.py-3{"data-action": "click->delete-confirmation#close", type: "button"}
                = t('.cancel')

    .mb-4.flex.justify-between.items-center
      %div
        %p.text-sm.text-gray-600
          = t('.showing', from: @change_groups.offset_value + 1, to: [@change_groups.offset_value + @change_groups.size, @change_groups.total_count].min, total: @change_groups.total_count)
        - if @filter.present? || @word_type_filter.present? || @keyword_filter.present?
          %p.text-xs.text-gray-500
            = t('.filtered_by', filter: [@filter, @word_type_filter, @keyword_filter].compact.join(", "))

    .pagination-wrapper.mb-4
      = paginate @change_groups, params: {sort_by: @sort_by, sort_direction: @sort_direction, per_page: @per_page, filter: @filter, word_type_filter: @word_type_filter, keyword_filter: @keyword_filter}

    .overflow-x-auto
      %table.w-full.text-sm
        %thead
          %tr.border-b.border-gray-300
            %th.px-4.py-3.text-left.font-semibold
              = sortable_link(t('.word'), 'word_name', @sort_by, @sort_direction)
            %th.px-4.py-3.text-left.font-semibold
              = sortable_link(t('.word_type'), 'word_type', @sort_by, @sort_direction)
            %th.px-4.py-3.text-left.font-semibold
              = sortable_link(t('.review_type'), 'review_type', @sort_by, @sort_direction)
            %th.px-4.py-3.text-left.font-semibold
              = t('.changes')
            %th.px-4.py-3.text-left.font-semibold
              = sortable_link(t('.created'), 'created_at', @sort_by, @sort_direction)
            %th.px-4.py-3.text-left.font-semibold
              = sortable_link(t('.reviews'), 'reviews_count', @sort_by, @sort_direction)
            %th.px-4.py-3.text-right.font-semibold
              = t('.actions')

        %tbody
          - @change_groups.each do |change_group|
            %tr.border-b.border-gray-100.hover:bg-gray-50
              %td.px-4.py-3
                - if change_group.word_attribute_edits.present?
                  = link_to change_group.word_attribute_edits.first.word.name, change_group.word_attribute_edits.first.word, class: 'text-blue-600 hover:text-blue-900 font-medium'
                - elsif change_group.new_word.present?
                  %span.font-medium= change_group.new_word.name
                  %span.ml-2.text-xs.bg-yellow-100.text-yellow-800.px-2.py-1.rounded= t('.new')

              %td.px-4.py-3
                - if change_group.word_attribute_edits.present?
                  %span.text-xs.bg-blue-100.text-blue-800.px-2.py-1.rounded
                    = change_group.word_attribute_edits.first.word.class.model_name.human
                - elsif change_group.new_word.present?
                  %span.text-xs.bg-blue-100.text-blue-800.px-2.py-1.rounded
                    = change_group.new_word.word_type

              %td.px-4.py-3
                - if change_group.word_attribute_edits.present?
                  %span.text-xs.bg-green-100.text-green-800.px-2.py-1.rounded= t('.attribute_edits', count: change_group.word_attribute_edits.count)
                - elsif change_group.new_word.present?
                  %span.text-xs.bg-purple-100.text-purple-800.px-2.py-1.rounded= t('.new_word_proposal')

              %td.px-4.py-3
                - if change_group.word_attribute_edits.present?
                  .text-xs.space-y-1
                    - change_group.word_attribute_edits.limit(3).each do |edit|
                      %div
                        %span.font-medium= edit.attribute_label + ":"
                        %span.text-gray-600= format_proposed_attribute(edit)
                    - if change_group.word_attribute_edits.count > 3
                      %div.text-gray-500
                        = t('.and_more', count: change_group.word_attribute_edits.count - 3)
                - elsif change_group.new_word.present?
                  .text-xs.space-y-1
                    - if change_group.new_word.topic.present?
                      %div
                        %span.font-medium= t('.topic') + ":"
                        %span.text-gray-600= change_group.new_word.topic

              %td.px-4.py-3.text-sm.text-gray-500
                = time_ago_in_words(change_group.created_at)

              %td.px-4.py-3
                - confirmed_count = change_group.reviews.where(state: :confirmed).count
                - skipped_count = change_group.reviews.where(state: :skipped).count
                - other_count = change_group.reviews.where.not(state: [:confirmed, :skipped]).count

                - if confirmed_count > 0
                  %span.inline-block.mr-1.text-xs.bg-green-100.text-green-800.px-2.py-1.rounded
                    ✓ #{confirmed_count}
                - if skipped_count > 0
                  %span.inline-block.mr-1.text-xs.bg-yellow-100.text-yellow-800.px-2.py-1.rounded
                    − #{skipped_count}
                - if other_count > 0
                  %span.inline-block.text-xs.bg-gray-100.text-gray-800.px-2.py-1.rounded
                    ◇ #{other_count}
                - if change_group.reviews.empty?
                  %span.text-xs.text-gray-400= t('.no_reviews')

              %td.px-4.py-3.text-right
                = link_to t('.review'), review_path(change_group), class: 'button button-sm primary'

    .pagination-wrapper.mt-6.flex.justify-between.items-center
      = paginate @change_groups, params: {sort_by: @sort_by, sort_direction: @sort_direction, per_page: @per_page, filter: @filter, word_type_filter: @word_type_filter, keyword_filter: @keyword_filter}

      .flex.items-center.gap-2
        %label.text-sm.text-gray-600
          = t('.per_page')
        = form_with url: pending_reviews_path, method: :get, class: 'inline' do |f|
          = f.hidden_field :sort_by, value: @sort_by
          = f.hidden_field :sort_direction, value: @sort_direction
          = f.hidden_field :filter, value: @filter
          = f.hidden_field :word_type_filter, value: @word_type_filter
          = f.hidden_field :keyword_filter, value: @keyword_filter
          = f.select :per_page, [25, 50, 100, 250, 500], { selected: @per_page }, { class: 'px-3 py-2 border border-gray-300 rounded-md text-sm', onchange: 'this.form.submit()' }
