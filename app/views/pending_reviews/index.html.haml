= title t('.title')

- if @no_matches
  = box do
    .mb-6
      %p.text-center.text-red-600
        = t('.no_matches')
      %p.text-center.text-sm.text-gray-600
        = t('.filter_was', filter: @filter)
      .text-center.mt-4
        = link_to t('.back'), pending_reviews_path, class: 'button primary'

- if @change_groups.empty? && !@no_matches
  = box do
    %p.text-center.text-gray-600= t('.no_pending_reviews')
- elsif !@no_matches
  = box do
    .mb-4
      = form_with url: pending_reviews_path, method: :get, class: 'flex gap-2 items-center' do |f|
        = f.text_field :filter, value: @filter, placeholder: t('.filter_table_placeholder'), class: 'px-3 py-2 border border-gray-300 rounded-md text-sm flex-grow'
        = f.hidden_field :sort_by, value: @sort_by
        = f.hidden_field :sort_direction, value: @sort_direction
        = f.hidden_field :per_page, value: @per_page
        = f.submit t('.filter_table_button'), class: 'button button-sm primary'
        - if @filter.present?
          = link_to t('.clear_filter'), pending_reviews_path(sort_by: @sort_by, sort_direction: @sort_direction, per_page: @per_page), class: 'button button-sm'

    .mb-6.flex.justify-between.items-center
      %div
        %p.text-sm.text-gray-600
          = t('.showing', from: @change_groups.offset_value + 1, to: [@change_groups.offset_value + @change_groups.size, @change_groups.total_count].min, total: @change_groups.total_count)
        - if @filter.present?
          %p.text-xs.text-gray-500
            = t('.filtered_by', filter: @filter)

      = form_with url: delete_filtered_pending_reviews_path, method: :post, class: 'flex gap-2 items-center' do |f|
        = f.text_field :filter, placeholder: t('.delete_filter_placeholder'), class: 'px-3 py-2 border border-gray-300 rounded-md text-sm'
        = f.submit t('.delete_button'), class: 'button button-sm danger', data: { confirm: false }

    .overflow-x-auto
      %table.w-full.text-sm
        %thead
          %tr.border-b.border-gray-300
            %th.px-4.py-3.text-left.font-semibold
              = sortable_link(t('.word'), 'word_name', @sort_by, @sort_direction)
            %th.px-4.py-3.text-left.font-semibold
              = sortable_link(t('.word_type'), 'word_type', @sort_by, @sort_direction)
            %th.px-4.py-3.text-left.font-semibold
              = sortable_link(t('.review_type'), 'review_type', @sort_by, @sort_direction)
            %th.px-4.py-3.text-left.font-semibold
              = t('.changes')
            %th.px-4.py-3.text-left.font-semibold
              = sortable_link(t('.created'), 'created_at', @sort_by, @sort_direction)
            %th.px-4.py-3.text-left.font-semibold
              = sortable_link(t('.reviews'), 'reviews_count', @sort_by, @sort_direction)
            %th.px-4.py-3.text-right.font-semibold
              = t('.actions')

        %tbody
          - @change_groups.each do |change_group|
            %tr.border-b.border-gray-100.hover:bg-gray-50
              %td.px-4.py-3
                - if change_group.word_attribute_edits.present?
                  = link_to change_group.word_attribute_edits.first.word.name, change_group.word_attribute_edits.first.word, class: 'text-blue-600 hover:text-blue-900 font-medium'
                - elsif change_group.new_word.present?
                  %span.font-medium= change_group.new_word.name
                  %span.ml-2.text-xs.bg-yellow-100.text-yellow-800.px-2.py-1.rounded= t('.new')

              %td.px-4.py-3
                - if change_group.word_attribute_edits.present?
                  %span.text-xs.bg-blue-100.text-blue-800.px-2.py-1.rounded
                    = change_group.word_attribute_edits.first.word.class.model_name.human
                - elsif change_group.new_word.present?
                  %span.text-xs.bg-blue-100.text-blue-800.px-2.py-1.rounded
                    = change_group.new_word.word_type

              %td.px-4.py-3
                - if change_group.word_attribute_edits.present?
                  %span.text-xs.bg-green-100.text-green-800.px-2.py-1.rounded= t('.attribute_edits', count: change_group.word_attribute_edits.count)
                - elsif change_group.new_word.present?
                  %span.text-xs.bg-purple-100.text-purple-800.px-2.py-1.rounded= t('.new_word_proposal')

              %td.px-4.py-3
                - if change_group.word_attribute_edits.present?
                  .text-xs.space-y-1
                    - change_group.word_attribute_edits.limit(3).each do |edit|
                      %div
                        %span.font-medium= edit.attribute_label + ":"
                        %span.text-gray-600= format_proposed_attribute(edit)
                    - if change_group.word_attribute_edits.count > 3
                      %div.text-gray-500
                        = t('.and_more', count: change_group.word_attribute_edits.count - 3)
                - elsif change_group.new_word.present?
                  .text-xs.space-y-1
                    - if change_group.new_word.topic.present?
                      %div
                        %span.font-medium= t('.topic') + ":"
                        %span.text-gray-600= change_group.new_word.topic

              %td.px-4.py-3.text-sm.text-gray-500
                = time_ago_in_words(change_group.created_at)

              %td.px-4.py-3
                - confirmed_count = change_group.reviews.where(state: :confirmed).count
                - skipped_count = change_group.reviews.where(state: :skipped).count
                - other_count = change_group.reviews.where.not(state: [:confirmed, :skipped]).count

                - if confirmed_count > 0
                  %span.inline-block.mr-1.text-xs.bg-green-100.text-green-800.px-2.py-1.rounded
                    ✓ #{confirmed_count}
                - if skipped_count > 0
                  %span.inline-block.mr-1.text-xs.bg-yellow-100.text-yellow-800.px-2.py-1.rounded
                    − #{skipped_count}
                - if other_count > 0
                  %span.inline-block.text-xs.bg-gray-100.text-gray-800.px-2.py-1.rounded
                    ◇ #{other_count}
                - if change_group.reviews.empty?
                  %span.text-xs.text-gray-400= t('.no_reviews')

              %td.px-4.py-3.text-right
                = link_to t('.review'), review_path(change_group), class: 'button button-sm primary'

    .mt-6.flex.justify-between.items-center
      = paginate @change_groups, params: {sort_by: @sort_by, sort_direction: @sort_direction, per_page: @per_page, filter: @filter}

      .flex.items-center.gap-2
        %label.text-sm.text-gray-600
          = t('.per_page')
        = form_with url: pending_reviews_path, method: :get, class: 'inline' do |f|
          = f.hidden_field :sort_by, value: @sort_by
          = f.hidden_field :sort_direction, value: @sort_direction
          = f.hidden_field :filter, value: @filter
          = f.select :per_page, [25, 50, 100, 250, 500], { selected: @per_page }, { class: 'px-3 py-2 border border-gray-300 rounded-md text-sm', onchange: 'this.form.submit()' }
