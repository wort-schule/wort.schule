#!/bin/bash
set -e

echo "=== Emergency fix for mise deployment issue ==="
echo ""
echo "This script will fix the systemd services to work with mise instead of rvm."
echo ""
echo "Instructions:"
echo "1. SSH into the production server: ssh wortschule@wort.schule"
echo "2. Run these commands:"
echo ""
echo "# Create temporary systemd service for Rails app"
echo "cat > /tmp/wortschule.service << 'EOF'"
cat systemd/wortschule.service
echo "EOF"
echo ""
echo "# Create temporary systemd service for background jobs"
echo "cat > /tmp/wortschule-jobs.service << 'EOF'"
cat systemd/wortschule-jobs.service
echo "EOF"
echo ""
echo "# Install the services (needs sudo)"
echo "sudo cp /tmp/wortschule.service /etc/systemd/system/"
echo "sudo cp /tmp/wortschule-jobs.service /etc/systemd/system/"
echo "sudo systemctl daemon-reload"
echo "sudo systemctl restart wortschule"
echo "sudo systemctl restart wortschule-jobs"
echo ""
echo "# Check if services are running"
echo "sudo systemctl status wortschule"
echo "sudo systemctl status wortschule-jobs"
echo ""
echo "=== End of instructions ==="